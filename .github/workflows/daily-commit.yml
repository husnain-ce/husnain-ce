name: Daily Commit

on:
  schedule:
    # Runs every day at 00:00 UTC (adjust timezone as needed)
    # To change time, modify the cron: '0 0 * * *' format
    # Format: minute hour day month day-of-week
    - cron: '0 0 * * *'
  workflow_dispatch: # Allows manual trigger from Actions tab

permissions:
  contents: write # Required for pushing commits

jobs:
  daily-commit:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Git config
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git config --local pull.rebase false

    - name: Pull latest changes
      run: |
        git pull origin main || echo "Already up to date or pull failed"

    - name: Create .github directory if it doesn't exist
      run: |
        mkdir -p .github

    - name: Make 10 daily contributions
      run: |
        DATE=$(date -u '+%Y-%m-%d')
        TIMESTAMP=$(date -u '+%Y-%m-%d %H:%M:%S UTC')
        
        # Make 10 separate commits for daily contributions
        for i in {1..10}; do
          # Update the main commit file with contribution number
          echo "Last updated: $TIMESTAMP" > .github/daily-commit.txt
          echo "Daily contribution $i of 10" >> .github/daily-commit.txt
          echo "Date: $DATE" >> .github/daily-commit.txt
          echo "Contribution timestamp: $(date -u '+%H:%M:%S')" >> .github/daily-commit.txt
          echo "" >> .github/daily-commit.txt
          echo "This file is automatically updated by GitHub Actions workflow." >> .github/daily-commit.txt
          echo "Contribution #$i" >> .github/daily-commit.txt
          
          git add .github/daily-commit.txt
          if ! git diff --staged --quiet; then
            git commit -m "chore: daily contribution $i/10 - $DATE [$(date -u '+%H:%M:%S')]"
          else
            # If no changes, make an empty commit to ensure contribution count
            git commit -m "chore: daily contribution $i/10 - $DATE [$(date -u '+%H:%M:%S')]" --allow-empty
          fi
          
          # Small delay to ensure unique timestamps
          sleep 2
        done

    - name: Pull latest changes before pushing
      run: |
        git pull origin main --no-edit || git pull origin main --no-rebase --no-edit || echo "Pull completed or no changes"

    - name: Push all contributions
      run: |
        git push origin main

